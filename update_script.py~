
import pandas as pd
import tweepy
import datetime
from sqlalchemy import create_engine

con_str='postgresql://wvhinoanhovbsk:3006a4afc14bd3cd8dd89f0c2ad87ea3c7d02f193c25fd6d3bc5a760af736611@ec2-3-229-252-6.compute-1.amazonaws.com:5432/d9lo2fp4iaggmf'
consumer_key = "lPKCdHNPrV77RRouvZbv3w04y"
consumer_secret = "dDpDFoopKZvSWhfSc1iTTkKp0OR4eQK8zFdu5M6VgsGfmms9OW"
access_token = "728052118893023233-il6fQLx7xCVLhb3EfpYYwqwnw6SOe1n"
access_token_secret = "Atr11smgRXGPF6Rm6YfvZvrwmOfXXQ6Rz3029dFhPCfaD"

engine=create_engine(con_str)
df=pd.read_sql_query("SELECT usertw FROM trackerdb",engine)

users=df['usertw'].unique().tolist()
auth = tweepy.OAuthHandler(consumer_key, consumer_secret)
auth.set_access_token(access_token, access_token_secret)

api=tweepy.API(auth)
today=datetime.datetime.now()
#date_tw='2022-04-25'
for user in users:
	twitter_user=api.get_user(screen_name=user)
	nfollowers=twitter_user.followers_count
	#query=f"""INSERT INTO trackerdb (usertw,datetw,followers) VALUES ('{user}','{date_tw}',{nfollowers})"""
	query=f"""INSERT INTO trackerdb (usertw,datetw,followers) VALUES ('{user}','{str(today)}',{nfollowers})"""
	connection=engine.raw_connection()
	cursor=connection.cursor()
	cursor.execute(query)
	connection.commit()
	cursor.close()


